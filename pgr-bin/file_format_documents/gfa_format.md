# GFA Output Format in PGR-TK

## Overview

PGR-TK generates Graph Fragment Assembly (GFA) files to represent pangenome assembly graphs. These graphs are based on the Minimizer Anchored Pangenome (MAP) concept, which uses shimmer pairs (minimizers) to anchor paths through the genome.

Two main types of GFA files are produced:
- **MAP Graph GFA** (.mapg.gfa) - representing the full minimizer-anchored paths graph
- **Principal MAP Graph GFA** (.pmapg.gfa) - representing a simplified version with principal bundles

## File Format Specification

GFA files in PGR-TK follow the standard GFA specification with customizations for MAP graphs:

### Header Line (H)
```
H   VN:Z:1.0   CM:Z:Sparse Genome Graph Generated By pgr-tk
```
- `VN:Z:1.0` - Version number of the format
- `CM:Z:...` - Comment describing the file

### Segments (S lines)
Segments represent nodes in the graph:

```
S   <id>   *   LN:i:<length>   SN:Z:<shmmr_pair_signature>   [BN:i:<bundle_id>   BP:i:<position>]
```

Fields:
- `<id>` - Numerical identifier for the segment
- `*` - Placeholder for sequence (not stored in this representation)
- `LN:i:<length>` - Length of the segment (average length plus k-mer size)
- `SN:Z:<shmmr_pair_signature>` - Hexadecimal representation of the shimmer pair (hash0_hash1)

Optional fields for principal bundle GFA:
- `BN:i:<bundle_id>` - Principal bundle identifier
- `BP:i:<position>` - Position within the bundle

### Links (L lines)
Links represent edges connecting segments:

```
L   <id1>   <strand1>   <id2>   <strand2>   <cigar>   SC:i:<support_count>
```

Fields:
- `<id1>`, `<id2>` - IDs of connected segments
- `<strand1>`, `<strand2>` - Orientation (`+` or `-`)
- `<cigar>` - CIGAR string (typically `kM` where k is the k-mer size)
- `SC:i:<support_count>` - Number of sequences supporting this connection

## MAP Graph Index Format (.mapg.idx)

The MAP Graph index (.mapg.idx) file complements the GFA representation with a tab-delimited text format. Each line begins with a single character that identifies the record type:

### K Record (SHIMMER Parameters)
```
K\t<w>\t<k>\t<r>\t<min_span>\t<sketch>
```

Fields:
- `w` - Window size parameter (integer)
- `k` - K-mer size parameter (integer)
- `r` - Reduction factor parameter (integer)
- `min_span` - Minimum span length parameter (integer)
- `sketch` - Boolean flag (true/false) indicating if sketching was used

### C Record (Contig Information)
```
C\t<id>\t<contig_name>\t<source>\t<length>
```

Fields:
- `id` - Unique identifier for the contig (integer)
- `contig_name` - Name of the contig
- `source` - Source sample name or "NA" if not available
- `length` - Length of the contig (integer)

### F Record (Fragment Information)
```
F\t<shimmer_pair_id>\t<seq_id>\t<direction>\t<start>\t<end>\t<fragment_id>
```

Fields:
- `shimmer_pair_id` - SHIMMER pair identifier in hex format (e.g., "0123456789ABCDEF_0123456789ABCDEF")
- `seq_id` - Sequence identifier (integer)
- `direction` - Direction/orientation of the fragment (integer)
- `start` - Start position of the fragment (integer)
- `end` - End position of the fragment (integer)
- `fragment_id` - Fragment identifier (integer)

The index file allows for efficient loading and querying of the graph structure without having to parse the entire GFA file, which can be much larger.

## Use Cases

- Representing complex genomic regions across multiple samples
- Analyzing structural variations and sequence relationships
- Visualizing pangenome structure
- Identifying shared genomic regions (principal bundles)

The GFA format enables visualization and algorithmic analysis of the graph structure, facilitating exploration of sequence relationships across multiple genomes, particularly in repetitive and structurally complex regions.